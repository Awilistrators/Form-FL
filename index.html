<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=1024">
<title>Laporan Frontliner</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  font-family:Poppins;
  background:#f4f6f9;
  padding:15px;
  color:#ff4fa3;
}

.container{
  max-width:100%;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
}

h1{
  text-align:center;
  font-size:20px;
  margin-bottom:20px;
}

button{
  width:100%;
  padding:14px;
  background:#ff4fa3;
  border:none;
  color:white;
  font-weight:600;
  border-radius:10px;
  cursor:pointer;
  margin-bottom:15px;
  font-size:15px;
}

button:hover{ background:#e04391; }

.btn-rekap{ background:#2d8cff; }
.btn-rekap:hover{ background:#1f6fe0; }

.table-wrapper{
  overflow-x:auto;
  width:100%;
  margin-top:10px;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
  min-width:750px;
}

th{
  background:#ff4fa3;
  color:white;
  padding:8px;
  position: sticky;
  top: 0;
}

td{
  padding:6px;
  border-bottom:1px solid #eee;
  text-align:center;
  color:#000;
}

td:nth-child(2){
  text-align:left;
  padding-left:10px;
}

.info-update{
  margin-top:14px;
  margin-bottom:10px;
  font-size:13px;
  color:#2d8cff;
  font-style:italic;
  line-height:1.5;
}

.total{
  margin-top:18px;
  font-weight:600;
  color:#ff4fa3;
  font-size:18px;
  line-height:1.6;
}
</style>
</head>

<body>

<div class="container">

<h1>LAPORAN FRONTLINER<br>SURYATOKOKU</h1>

<button onclick="location.href='form.html'">
‚úèÔ∏è Isi Laporan Harian
</button>

<button class="btn-rekap" onclick="location.href='https://awilistrators.it.com/Form-FL/rekap.html'">
üìä Rekapan Laporan
</button>

<h3 id="judulTanggal">Laporan Hari Ini :</h3>

<div class="table-wrapper">
<table>
<thead>
<tr>
<th>No</th>
<th>Nama</th>
<th>Posisi</th>
<th>COD</th>
<th>Closing</th>
<th>Postingan</th>
<th>Display</th>
<th>Expired</th>
</tr>
</thead>
<tbody id="data"></tbody>
</table>
</div>

<div class="info-update">
‚ÑπÔ∏è Apabila terdapat kesalahan input atau perubahan data, laporan harian dapat diisi ulang.<br>
Sistem akan otomatis memperbarui data sebelumnya dengan data terbaru.
</div>

<div class="total">
Total COD: <span id="totalCod">0</span><br>
Total Closing: <span id="totalClosing">0</span>
</div>

</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbx2RrZq8oL_PGEzpuh35g2ZoGrGeqySoMCZINQPV1WVOQGYkKmbU4-MJKa7fFzyqOi6mw/exec?rekap=1";

function formatRupiah(n){
  return n ? "Rp" + new Intl.NumberFormat("id-ID").format(n) : "-";
}

function loadData(){

 // tampilkan tanggal hari ini di judul
 const today = new Date().toLocaleDateString("id-ID", {
   day:"numeric",
   month:"long",
   year:"numeric"
 });

 document.getElementById("judulTanggal").innerHTML =
   "Laporan Hari Ini : " + today;

 fetch(scriptURL)
  .then(res=>res.json())
  .then(data=>{
    const tbody=document.getElementById("data");
    tbody.innerHTML="";

    let totalCod=0;
    let totalClosing=0;

    data.forEach(row=>{

      if(!row[1]) return;

      // ambil angka COD dari teks
      const codNumber = parseInt(String(row[3]).replace(/\D/g,'')) || 0;

      // ambil angka closing
      const closingNumber = parseInt(String(row[4]).replace(/\D/g,'')) || 0;

      // format tampilan COD
      const codFormat = codNumber
        ? "Rp" + new Intl.NumberFormat("id-ID").format(codNumber)
        : "-";

      // format tampilan closing
      const closingFormat = closingNumber
        ? new Intl.NumberFormat("id-ID").format(closingNumber) + " Transaksi"
        : "-";

      totalCod += codNumber;
      totalClosing += closingNumber;

      const tr = document.createElement("tr");

      tr.innerHTML=`
        <td>${row[0]}</td>
        <td>${row[1]}</td>
        <td>${row[2]}</td>
        <td>${codFormat}</td>
        <td>${closingFormat}</td>
        <td>${row[5] || "-"}</td>
        <td>${row[6] || "-"}</td>
        <td>${row[7] || "-"}</td>
      `;

      tbody.appendChild(tr);
    });

    // üî• total ditaruh setelah loop selesai
    document.getElementById("totalCod").innerHTML =
      "Rp" + new Intl.NumberFormat("id-ID").format(totalCod);

    document.getElementById("totalClosing").innerHTML =
      new Intl.NumberFormat("id-ID").format(totalClosing) + " Transaksi";

  });
}


loadData();
</script>

</body>
</html>
