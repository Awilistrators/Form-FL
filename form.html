<!DOCTYPE html>
<html>
<head>
  <title>Form Frontliner Suryatokoku</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Poppins', sans-serif;
  background: #f4f6f9;
  margin: 0;
  padding: 20px;
  color: #ff4fa3;
}

.container {
  max-width: 500px;
  margin: auto;
  background: #ffffff;
  padding: 25px;
  border-radius: 15px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
}

h2 {
  text-align: center;
  margin-bottom: 25px;
}

label {
  font-weight: 600;
  font-size: 14px;
}

input, select {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  margin-bottom: 15px;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 14px;
  box-sizing: border-box;
}

button {
  width: 100%;
  padding: 12px;
  background: #ff4fa3;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
}

button:hover {
  background: #e04391;
}

/* INFO TEXT */
.info-text{
  display:block;
  font-size:12px;
  font-style:italic;
  color:#2d8cff;
  margin-top:-8px;
  margin-bottom:14px;
  line-height:1.4;
}

.info-text a{
  color:#2d8cff;
  font-weight:600;
  text-decoration:none;
}

.info-text a:hover{
  text-decoration:underline;
}

/* SEARCH DROPDOWN */
.search-container { position: relative; }

.dropdown {
  position: absolute;
  width: 100%;
  background: white;
  border: 1px solid #ddd;
  border-radius: 8px;
  max-height: 180px;
  overflow-y: auto;
  display: none;
  z-index: 1000;
}

.dropdown div {
  padding: 10px;
  cursor: pointer;
}

.dropdown div:hover {
  background: #f2f2f2;
}

/* POPUP */
.popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.25);
  z-index: 9999;
}

.popup-box {
  background: white;
  padding: 20px 30px;
  border-radius: 14px;
  font-weight: 600;
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  text-align: center;
  color: #ff4fa3;
}

#popupBtn {
  margin-top: 15px;
  width: 100%;
  background: #ff4fa3;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}
</style>
</head>

<body>

<div class="container">
  <h2>LAPORAN HARIAN<br>FRONTLINER SURYATOKOKU</h2>

  <form id="formFrontliner">

    <label>Nama</label>
    <div class="search-container">
      <input type="text" id="namaSearch" placeholder="Memuat data nama..." disabled required>
      <div id="dropdownList" class="dropdown"></div>
    </div>
    <input type="hidden" name="nama" id="namaHidden">

    <!-- INFO TEXT + WHATSAPP LINK -->
    <small class="info-text">
      ‚ÑπÔ∏è Nama hanya dapat dipilih dari daftar yang tersedia.<br>
      Jika nama belum terdaftar atau perlu perubahan data,
      <a href="https://wa.me/6283877710233?text=A'%20mau%20daftar%20atau%20ubah%20nama%20data%20laporan%20FL%20Suryatokoku..." target="_blank">
      silakan klik di sini
      </a>.
    </small>

    <label>Posisi</label>
    <select name="posisi" required>
      <option value="">Pilih Posisi</option>
      <option>Pramuniaga</option>
      <option>Beauty Advisor</option>
      <option>Kasir</option>
    </select>

    <label>Nominal COD</label>
    <input type="text" name="cod" id="cod" placeholder="Ex: Rp1.000.000">

    <label>Jumlah Closingan Medsos</label>
    <input type="text" name="closingan" id="closingan" placeholder="Ex: 100 Transaksi">

    <label>Jumlah Postingan Medsos</label>
    <input type="text" name="medsos" placeholder="Ex: 10 Story WA, 5 Story IG">

    <label>Display & Kebersihan</label>
    <select name="display">
      <option>Belum maksimal</option>
      <option>Sudah rapi & bersih</option>
    </select>

    <label>Cek Expired</label>
    <select name="expired">
      <option>Belum Sempat</option>
      <option>Sudah - Aman</option>
      <option>Sudah - Mendekati expired</option>
      <option>Sudah - Ada expired</option>
    </select>

    <button type="submit">Kirim Laporan</button>

  </form>
</div>

<!-- POPUP -->
<div id="popup" class="popup">
  <div class="popup-box">
    <div id="popupText">Memuat...</div>
    <button id="popupBtn" style="display:none;">
      Oke siap dengan senang hati üòä
    </button>
  </div>
</div>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycbwuOEOAHi0iQHUsdzFKxENor-t39RNmbpiW36ZFD0gRVm-NMrrrnUpuRtUU7XMUkTseZg/exec';
const form = document.getElementById('formFrontliner');
const submitBtn = form.querySelector("button");

let daftarNama = [];

const namaSearch = document.getElementById("namaSearch");
const dropdownList = document.getElementById("dropdownList");
const namaHidden = document.getElementById("namaHidden");
const codInput = document.getElementById("cod");
const popup = document.getElementById("popup");
const popupText = document.getElementById("popupText");
const popupBtn = document.getElementById("popupBtn");

function showPopup(text, showButton=false){
  popupText.innerHTML=text;
  popup.style.display="flex";
  popupBtn.style.display=showButton?"block":"none";
}
popupBtn.onclick=()=>popup.style.display="none";

/* LOAD NAMA */
fetch(scriptURL)
.then(res=>res.json())
.then(data=>{
  daftarNama=data;
  namaSearch.disabled=false;
  namaSearch.placeholder="Ketik nama...";
})
.catch(()=> namaSearch.placeholder="Gagal memuat data");

/* SEARCH */
namaSearch.addEventListener("input", function(){
  const keyword=this.value.toLowerCase();
  dropdownList.innerHTML="";
  if(!keyword){ dropdownList.style.display="none"; return; }

  const hasil=daftarNama.filter(n=>n.toLowerCase().includes(keyword));
  hasil.forEach(n=>{
    const div=document.createElement("div");
    div.textContent=n;
    div.onclick=()=>{
      namaSearch.value=n;
      namaHidden.value=n;
      dropdownList.style.display="none";
    };
    dropdownList.appendChild(div);
  });
  dropdownList.style.display=hasil.length?"block":"none";
});

/* FORMAT RUPIAH */
codInput.addEventListener("input", function(){
  let value=this.value.replace(/\D/g,"");
  this.value=value ? "Rp"+new Intl.NumberFormat("id-ID").format(value) : "";
});

/* FORMAT TRANSAKSI */
const closingInput=document.getElementById("closingan");
closingInput.addEventListener("input",()=> closingInput.value=closingInput.value.replace(/\D/g,""));
closingInput.addEventListener("blur",()=>{ if(closingInput.value) closingInput.value+=" Transaksi"; });
closingInput.addEventListener("focus",()=> closingInput.value=closingInput.value.replace(/\D/g,""));

/* SUBMIT */
form.addEventListener('submit', e=>{
 e.preventDefault();

 if(!daftarNama.includes(namaHidden.value)){
   showPopup("Nama belum terdaftar!");
   setTimeout(()=>popup.style.display="none",1500);
   return;
 }

 showPopup("Mengirim laporan...");
 submitBtn.disabled=true;

 codInput.value=codInput.value.replace(/\D/g,"");
 closingInput.value=closingInput.value.replace(/\D/g,"");

 fetch(scriptURL,{method:'POST',body:new FormData(form)})
 .then(()=>{
   showPopup("‚úî Laporan berhasil dikirim<br><br>Terima kasih atas kerja keras hari ini üôè<br>Tetap semangat dan terus memberikan yang terbaik! ‚ú®",true);
   form.reset();
   namaHidden.value="";
   submitBtn.disabled=false;
 })
 .catch(()=>{
   showPopup("Gagal mengirim data");
   submitBtn.disabled=false;
 });
});
</script>

</body>
</html>
